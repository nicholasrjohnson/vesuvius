#!/usr/bin/env node

var program = require('commander')
var rawBody = require('raw-body')
var path = require('path')
var fs = require('fs')

var dapper = require('..')

program.version(require('../package.json').version)
.usage('[<input>] [<output>]')
.parse(process.argv)

var args = program.args
var input = args[0] || '-'
if (input === '-') {
  rawBody(process.stdin, {
    encoding: 'utf8'
  }, function (err, body) {
    if (err) throw err
    exec(body)
  })
} else {
  exec(fs.readFileSync(path.resolve(input), 'utf8'))
}

function exec(input) {
  var res = dapper(input)
  var out = args[1] || '-'
  if (out === '-')
    process.stdout.write(res + '\n')
  else
    fs.writeFileSync(path.resolve(out), res, 'utf8')
  process.exit()
}